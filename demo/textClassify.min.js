/*! div2img 22-08-2016 XinleiStone 
 github: git+https://github.com/XinleiStone/div2img.git */
var textClassify={defaultWidth:650,defaultHeight:650,colors:["rgb(255, 228, 181)","rgb(205, 92, 92)","rgb(238, 221, 130)","rgb(244, 164, 96)","rgb(135, 206, 235)","rgb(102, 205, 170)","rgb(238, 233, 233)","rgb(154, 192, 205)","rgb(238, 174, 238)","rgb(105, 89, 205)"],bgColor:"#190c01",fontColor:"#bcd7f0",draw:function(a,b,c){function d(a){a?(e=a.weight?a.weight:textClassify.defaultWidth,f=a.height?a.height:textClassify.defaultHeight,g=a.colors?a.colors:textClassify.colors,h=a.bgColor?a.bgColor:textClassify.bgColor,i=a.fontColor?a.fontColor:textClassify.fontColor):(e=textClassify.defaultWidth,f=textClassify.defaultHeight,g=textClassify.colors,h=textClassify.bgColor,i=textClassify.fontColor)}var e,f,g,h,i;d(c);var j=d3.select("#"+b).append("svg").attr("width",e).attr("height",f);if(!j[0][0])return void console.log("div id wrong");if(j.append("rect").attr("width",e).attr("height",f).attr("fill",h),"string"==typeof a)textClassify.fromUrl(a,e,f,g,i,j);else{if("object"!=typeof a)return void console.log("json is wrong!");textClassify.fromJson(a,e,f,g,i,j)}},fromUrl:function(a,b,c,d,e,f){d3.json(a,function(a,g){return a?void console.warn(a):void textClassify._(g,b,c,d,e,f)})},fromJson:function(a,b,c,d,e,f){textClassify._(a,b,c,d,e,f)},_:function(a,b,c,d,e,f){function g(a){for(var b in a){var c=a[b].length,d=q(c);k={},k.type=b,k.children=[];for(var e=0;e<d;e++)a[b][e]?k.children.push(a[b][e]):k.children.push(a[b][e-1]);h(k,c)}}function h(a,g){function h(){l=q(i),o=d.length,v=a.children.length,w=v/l,r=b/2-120,p=[],u=[],s=0,x=d3.scale.linear().domain([0,1]).rangeRound([10,40]),y=d3.layout.cluster().size([360*w,r]).separation(function(a){return 20*Math.random()}),z=x(w),A=y.nodes(a),B=f.append("g").attr("transform","translate("+b/2+","+c/2+")"),t=Math.round(100*Math.random())%2==0?1:-1,p[0]=0;for(var e=1;e<A.length;e++)0==e%3?p[e]=5*Math.random():0==e%4||1==e%10?p[e]=10*Math.random()+15:0==e%5?p[e]=40*Math.random()+65:1==e%2?p[e]=10*Math.random()+45:p[e]=10*Math.random()+30}function j(){function a(a,b){for(var c=a.parentNode,d=c.childNodes.length,e=0;e<d;e++)"circle"==c.childNodes[e].tagName?(C=c.childNodes[e].style.fill,c.childNodes[e].style.fill="yellow"):"text"==c.childNodes[e].tagName&&(c.childNodes[e].style.opacity="0.8")}function b(a,b){for(var c=a.parentNode,d=c.childNodes.length,e=0;e<d;e++)"circle"==c.childNodes[e].tagName?c.childNodes[e].style.fill=C:"text"==c.childNodes[e].tagName&&(c.childNodes[e].style.opacity="0")}function c(a){var b=a.url;window.open(b)}var f=B.selectAll(".node").data(A).enter().append("g").attr("class","node").attr("transform",function(a,b){return a.children?"rotate("+a.x+")translate("+a.y+")rotate("+a.x+")":"rotate("+(a.x+n)+")translate("+(a.y-p[b])+")rotate("+a.x+")"}),g=d3.svg.line.radial(h).interpolate("basis").tension(.85).radius(function(a,b){return"0"==a.y?(s++,a.y):a.y-p[s]}).angle(function(a){return a.children?(a.x+90)/180*Math.PI:(a.x+n+90)/180*Math.PI});f.append("circle").attr("d",function(a,b){u[b]=[],u[b].push({x:0,y:0},{x:a.x-t*(Math.random()*r/60+Math.random()*r/60),y:r/2},{x:a.x+t*(Math.random()*r/60+Math.random()*r/60),y:r/12*11},{x:a.x,y:a.y})});for(var h=1;h<u.length;h++){B.selectAll("path.line").data(u[h]).enter().append("path").attr("class","link2").style("stroke",function(){return d[m%o]}).attr("d",g(u[h]))}f.append("circle").attr("r",function(a){if(!a.children)return 10}).attr("class","circle2").style("fill",function(a,b){if(u[b]=[],!a.children)return d[m%o]}).on("mouseover",function(b){a(this,b)}).on("mouseout",function(a){b(this,a)}).on("mouseup",function(a){c(a)}),f.append("text").attr({dy:".2em",class:"text","text-anchor":"middle",transform:function(a,b){return"rotate("+(-2*a.x-n)+")"},opacity:function(a){return"0"}}).attr("fill",e).text(function(a){if(!a.children)return a.name}).on("mouseover",function(b){a(this,b)}).on("mouseout",function(a){b(this,a)}).on("mouseup",function(a){c(a)}),k()}function k(){var b=a.children[0];a.children=[],a.children.push(b);var c=d3.layout.cluster().size([360*w,r+60]).separation(function(a){return 1}),e=c.nodes(a),f=B.selectAll(".node2").data(e).enter().append("g").attr("class","node").attr("transform",function(a,b){return a.children?"rotate("+a.x+")translate("+a.y+")rotate("+a.x+")":"rotate("+(a.x+n)+")translate("+a.y+")rotate("+a.x+")"});f.append("circle").attr("r",function(a){if(!a.children)return z/2}).attr("class","circle2").attr("transform",function(a){if(!a.children)return"rotate("+(-n-2*a.x)+")translate("+(-(6+30*w)-6-120*w)+","+(-6-60*w/2)+")"}).attr("fill",function(a,b){if(!a.children)return d[m%o]}),f.append("text").style("font-family","幼圆").style("text-anchor","start").style("dominant-baseline","middle").style("font-size",function(a){return z+"px"}).text(function(a){if(!a.children)return a.type}).attr("class","text-edge").attr("fill",function(a){return d[m%o]}).attr("transform",function(a){if(!a.children)return"rotate("+(-n-2*a.x)+")translate("+(-6-120*w)+","+(-6-60*w/2)+")"}),f.append("text").style("font-family","幼圆").style("text-anchor","start").style("dominant-baseline","middle").style("font-size",function(a){return z+"px"}).text(function(a){if(!a.children)return"曝光次数："+g}).attr("class","text-edge").attr("fill",function(a){return d[m%o]}).attr("transform",function(a){if(!a.children)return"rotate("+(-n-2*a.x)+")translate("+(-(6+60*w)-12-120*w)+","+(6+60*w/2)+")"})}var l,o,p,r,s,t,u,v,w,x,y,z,A,B,C;h(),j(),n+=360*w,m++}var i,j,k,l=[],m=0,n=0;if(!a.words)return void console.warn("json wrong");j=a.words,a.words.length&&(i=a.words.length);var o;for(o=0;o<i;o++)if(j[o].type){var p=j[o].type;l[p]||(l[p]=[]),l[p].push(j[o])}var q=d3.scale.linear().domain([0,i]).rangeRound([0,220]);g(l);var r=f.append("g");r.append("circle").attr("cx",b/2).attr("cy",c/2).attr("r",15).style("fill","rgb(255, 165, 0)"),d3.selectAll("g.node").style("cursor","pointer")}};